<!DOCTYPE html>
<html>
<head>
<title>test</title>
<script src="http://cdn.sockjs.org/sockjs-0.1.min.js"></script>
<script type="text/javascript" src="https://raw.github.com/atomizejs/cereal/master/lib/cereal.js"></script>
<script type="text/javascript" src="https://raw.github.com/atomizejs/atomize-client/master/lib/atomize.js"></script>
<script>

var atomize = new Atomize("http://localhost:9999/atomize");

function start() {
    atomize.atomically(function () {
        if (undefined === atomize.root.clients) {
            atomize.root.clients = 1;
            return true;
        } else {
            atomize.root.clients += 1;
            return false
        }
    }, function (writer) {
        atomize.atomically(function () {
            if (writer) {
                if (1 === atomize.root.clients) {
                    atomize.retry();
                } else {
                    atomize.root.notified = atomize.lift(Date());
                    delete atomize.root.clients
                    return "notified others";
                }
            } else {
                if (undefined === atomize.root.notified) {
                    atomize.retry();
                } else {
                    return atomize.root.notified.toString();
                }
            }
        }, function (result) {
            console.log(result)
        });
    });
}
</script>
</head>
<body onload="start();">
</body>
</html>
